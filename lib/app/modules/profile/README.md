# Profile 模块重构说明

## 重构目标
将原本复杂的 `profile_page.dart` 文件分解为多个模块，提高代码的可维护性和可读性。同时将个人信息编辑功能移到设置页面，设置入口放在成长页面右上角。

## 新的文件结构

```
lib/app/modules/profile/
├── components/                 # UI组件
│   ├── index.dart            # 组件导出文件
│   ├── user_header.dart      # 用户头部信息组件
│   ├── stats_card.dart       # 统计信息卡片组件
│   ├── basic_info_card.dart  # 基本信息卡片组件
│   └── pets_card.dart        # 宠物信息卡片组件
├── services/                  # 业务逻辑服务
│   ├── logout_service.dart   # 退出登录服务
│   └── mock_data_service.dart # 模拟数据服务
├── settings_page.dart         # 独立设置页面
└── profile_page.dart         # 主页面（重构后，专注于个人信息展示）
```

**注意**：数据模型已统一到 `lib/app/core/models.dart`，避免重复定义

## 主要改进

### 1. 模块化设计
- **组件分离**：将UI逻辑分离到独立的组件文件中
- **职责单一**：每个组件只负责特定的UI功能
- **可复用性**：组件可以在其他地方复用

### 2. 数据管理
- **模型统一**：使用 `lib/app/core/models.dart` 中的统一模型，避免重复定义
- **服务层**：业务逻辑封装在服务类中
- **状态管理**：使用 `AppState` 统一管理应用状态

### 3. 退出登录功能完善
- **多重清理**：清除本地存储、应用状态、认证服务状态
- **自动导航**：利用 `AuthWrapper` 自动处理登录状态变化
- **错误处理**：完善的异常处理和用户反馈

## 组件说明

### UserHeader
- 显示用户头像、姓名、等级、积分等信息
- 包含返回和编辑按钮
- 使用渐变背景和卡片样式
- 编辑按钮现在显示提示，引导用户到设置页面

### StatsCard
- 显示宠物数量、关注数、粉丝数、获赞数等统计信息
- 使用图标和颜色区分不同类型的数据

### BasicInfoCard
- 显示用户的基本信息（手机号、邮箱、地址、注册时间）
- 点击编辑项会显示提示，引导用户到设置页面进行编辑

### PetsCard
- 显示用户的宠物列表（最多显示3个）
- 支持复制宠物身份码
- 包含"查看全部"按钮



## 页面说明

### SettingsPage
- 独立的设置页面，包含所有设置选项
- **个人信息设置**：编辑资料、修改手机号、邮箱、地址等
- 通知设置、应用设置、隐私设置、关于等完整功能
- 包含退出登录按钮
- 使用卡片式布局，清晰分组

## 服务说明

### LogoutService
- 处理用户退出登录的完整流程
- 清除所有相关的本地数据
- 调用认证服务进行状态清理
- 自动导航到登录页面

### MockDataService
- 提供模拟的用户和宠物数据
- 用于开发和测试阶段

## 设置入口位置

### 主要设置入口
- **成长页面右上角**：在 `ArchiveProfilePage` 的页面头部添加了设置按钮
  - 使用主题色背景，带有阴影效果
  - 包含"设置"文字和图标，更加醒目
  - 与用户头像按钮风格统一，整体布局美观
- **个人信息页面**：不再包含设置按钮，编辑功能引导用户到设置页面

### 设置页面功能
- 个人信息编辑（头像、姓名、简介、手机号、邮箱、地址）
- 应用设置（通知、语言、主题、缓存）
- 隐私设置（隐私政策、用户协议、数据导出）
- 关于信息（版本信息、帮助中心、意见反馈）
- 退出登录

## 使用方法

### 导入组件
```dart
import 'components/index.dart';
```

### 使用组件
```dart
UserHeader(
  userProfile: userProfile,
  onEditProfile: _editProfile,
),

StatsCard(
  petCount: pets.length,
  followingCount: '128',
  followersCount: '256',
  likesCount: '1.2k',
),
```

### 退出登录
```dart
// 显示确认对话框
LogoutService.showLogoutDialog(context);

// 直接退出登录
LogoutService.logout(context);
```

## 注意事项

1. **路由配置**：退出登录后会自动返回到根页面，`AuthWrapper` 会检查登录状态并显示相应的页面
2. **状态同步**：确保 `AppState`、`UserAuthService` 和本地存储的状态保持一致
3. **错误处理**：所有异步操作都包含适当的错误处理
4. **上下文安全**：在异步操作后检查 `context.mounted` 状态

## 后续优化建议

1. **状态管理**：考虑使用 Riverpod 等状态管理库
2. **路由管理**：使用 GoRouter 等现代化路由库
3. **数据持久化**：实现更完善的数据缓存策略
4. **主题支持**：添加深色主题支持
5. **国际化**：支持多语言
